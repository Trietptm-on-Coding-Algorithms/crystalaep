// Copyright (c) Peter Winter-Smith [peterwintersmith@gmail.com]

#pragma once

namespace DemoUrlFilteringPolicies
{
	EAllowableOperation DisallowSiteVisit(CConnectionPool *pConnPool, CConnection *pConn);
}

namespace DemoSSLFilteringPolicies
{
	EAllowableOperation DisallowPermissiveSSL(CConnectionPool *pConnPool, CConnection *pConn);
}

namespace DemoRequestFilteringPolicies
{
	EAllowableOperation DisallowRequestToSlashFOO(CConnectionPool *pConnPool, CConnection *pConn);
	EAllowableOperation DisallowRequestContainingPHOOBAR(CConnectionPool *pConnPool, CConnection *pConn);
}

namespace DemoResponseFilteringPolicies
{
	static BYTE ReplacementPngTemplateImage[] =
		"\x89\x50\x4e\x47\x0d\x0a\x1a\x0a\x00\x00\x00\x0d\x49\x48\x44\x52"
		"\x00\x00\x00\x63\x00\x00\x00\x3a\x08\x02\x00\x00\x00\x2b\xd8\x70"
		"\xfd\x00\x00\x00\x01\x73\x52\x47\x42\x00\xae\xce\x1c\xe9\x00\x00"
		"\x00\x04\x67\x41\x4d\x41\x00\x00\xb1\x8f\x0b\xfc\x61\x05\x00\x00"
		"\x00\x09\x70\x48\x59\x73\x00\x00\x0e\xc3\x00\x00\x0e\xc3\x01\xc7"
		"\x6f\xa8\x64\x00\x00\x02\xa8\x49\x44\x41\x54\x78\x5e\xed\x99\xeb"
		"\x15\x83\x20\x0c\x85\x9d\xab\x03\x39\x4f\xa7\xe9\x32\x1d\xc6\x2a"
		"\x42\x48\x78\xd8\xeb\x03\x8e\xed\xb9\xfd\x57\x0d\x24\xf9\xb8\x41"
		"\x89\xc3\xc4\x1f\x46\x60\xc0\xcc\x68\x35\x91\x14\x2a\x02\x92\x22"
		"\x29\x94\x00\x6a\x47\x4d\x91\x14\x4a\x00\xb5\xa3\xa6\x48\x0a\x25"
		"\x80\xda\x51\x53\x24\x85\x12\x40\xed\xa8\x29\x92\x42\x09\xa0\x76"
		"\xd4\x14\x49\xa1\x04\x50\x3b\x6a\x8a\xa4\x50\x02\xa8\x1d\x35\x75"
		"\x4b\x52\xaf\x71\x18\xc6\x17\x1a\xda\xcd\xec\x10\x4d\xbd\x9f\x8f"
		"\x41\xfd\x8e\xe7\x7a\x73\x52\x4b\x9e\xf5\xe4\x50\x52\x8f\xe7\x7b"
		"\x5d\xe3\x33\xd9\x9e\x19\xdb\x41\x61\x17\x93\x5a\x50\x09\xb6\x49"
		"\xcb\x4d\x96\x63\xbe\x38\x5b\x2c\x58\xdc\x2f\x5a\x1b\x52\x6a\x68"
		"\x5c\xc8\xc2\x45\xc4\xc5\x3c\x81\x98\x45\x77\x53\x35\xbc\x59\x3a"
		"\x49\x78\xa6\x6e\xf4\x14\xb2\x42\x7b\x35\xe5\x66\x0c\x99\xe9\xcc"
		"\x97\x1b\xde\xc3\xea\x55\xff\xf1\x03\x94\xfd\x6b\x0c\xe1\xa8\x81"
		"\xcb\xfd\x70\xd9\x1b\x6c\xba\x58\xa7\xf5\x49\xc6\x3f\x71\x8a\x18"
		"\x6a\x2d\xbc\x74\xfe\xf3\xd5\x27\xfb\x94\xd5\x93\xa6\x2f\x62\x4b"
		"\x54\x1c\x45\x58\xae\x3e\x31\xcf\x6f\xab\xfc\x42\xe9\xaf\x1e\x8d"
		"\x0b\xf3\x47\x26\xc1\xc6\xea\x12\xb9\xb4\xfa\xd2\x25\xd0\x3b\xbd"
		"\xe8\x28\x27\xe5\x55\x58\x1f\xed\x96\xd2\xd4\xb5\x23\x93\x3c\x4b"
		"\x62\x2d\x83\xa4\x80\xf0\x94\xd3\x4b\x49\xb9\xd8\x55\x5d\x15\xc5"
		"\x0a\x68\xaa\x28\xfa\xb2\xa6\xbe\xbb\xa8\x6b\xea\xfb\xd8\x66\x9a"
		"\x32\x0f\xbf\x54\xdf\x61\xf3\xcb\xf6\xa9\x7c\xe3\x30\x3b\xd6\xbc"
		"\xf2\x6b\x4a\xf9\x3e\xb5\xe5\x42\x3f\x41\xe2\xd3\x3d\xce\x0c\x8d"
		"\x4d\x49\x15\x37\x73\x97\xd8\xde\x1d\x3d\x79\x4f\xb0\xe5\x61\xc4"
		"\x26\x0f\x97\xb8\xb0\x5a\x34\xea\xd9\xf3\x1c\x25\xd1\x38\x9f\x84"
		"\xbc\xe1\xc2\x2f\x4d\x59\x53\x79\xf5\x16\x6b\x41\x97\x7c\x70\x75"
		"\xf8\xd9\xb7\xf7\x55\x66\xbb\xde\xf7\xce\x76\x17\x7b\x44\x53\x7b"
		"\x63\x25\x29\x94\x18\x49\xa1\xa4\xfe\xd3\xae\x45\xf5\x91\xd4\x7f"
		"\x12\x40\xb3\xa2\xa6\x48\x0a\x25\x80\xda\x51\x53\x97\x92\xba\x79"
		"\x07\x0e\xcd\xf5\x9c\x1d\xa4\x29\x92\x02\xcf\x7d\xba\x23\x3c\xbf"
		"\x55\xea\x7e\x66\xa5\xd9\xa8\xce\x6a\xf6\xd4\x97\xb7\xe3\xf5\xb1"
		"\xee\x78\x87\xfe\x9c\x5c\xa0\xd1\x7b\x35\xb5\x26\xb6\xdd\x6c\xac"
		"\xf5\x33\x0b\x27\xd4\x4a\x4b\x13\x0a\xbd\xb3\xd1\x11\x52\xdf\xda"
		"\x1d\x2a\x05\x39\xd8\xe8\x13\x8e\x69\x8e\x16\xbb\xa6\x9d\x21\x40"
		"\xee\x9a\x90\xb2\x8d\x12\xe9\x3d\x79\x28\xb6\x83\x54\x6c\x4b\x42"
		"\xa1\x77\x36\x6a\x40\xaa\xd8\xcf\x34\xf0\x82\x28\x7f\xea\x28\xdd"
		"\x96\x94\x6b\xd7\x85\x1e\x79\x61\xbf\xae\xb5\x25\x3b\xcb\x05\x72"
		"\xd7\x80\xd4\xda\xe5\xf5\x9f\xfa\x62\x3f\x53\x2e\xda\x6f\x80\xc5"
		"\x96\x26\x14\x7a\x67\x23\x88\xd4\xf9\x98\x12\xf1\xe4\x5f\x61\xce"
		"\xbb\x68\x3d\x43\x27\x52\xf6\xdd\xf5\x97\x8a\x4e\x16\xa0\x13\xa9"
		"\xe4\xd3\x5d\xfd\x0b\x48\x6b\x65\x1c\x9f\xbf\x1b\xa9\xe3\x21\xde"
		"\x64\x24\x49\xa1\x0b\x41\x52\x24\x85\x12\x40\xed\xa8\x29\x92\x42"
		"\x09\xa0\x76\xd4\x14\x49\xa1\x04\x50\x3b\x6a\x0a\x25\xf5\x01\x4f"
		"\x10\x1d\xbf\x06\x4a\xaf\xad\x00\x00\x00\x00\x49\x45\x4e\x44\xae"
		"\x42\x60\x82";
	
	static size_t ReplacementPngTemplateImageSize = sizeof(ReplacementPngTemplateImage) - 1;
	
	EAllowableOperation DisallowImageContentType(CConnectionPool *pConnPool, CConnection *pConn);
	EAllowableOperation JustReadSomeDataFromStream(CConnectionPool *pConnPool, CConnection *pConn);
	EAllowableOperation RewriteUserAgentHeader(CConnectionPool *pConnPool, CConnection *pConn);
	EAllowableOperation ReplacePngWithTemplate(CConnectionPool *pConnPool, CConnection *pConn);
	EAllowableOperation SimpleParsePngFile(CConnectionPool *pConnPool, CConnection *pConn);
	EAllowableOperation ChunkedReadAttempt(CConnectionPool *pConnPool, CConnection *pConn);
}